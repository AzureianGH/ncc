; 8086 Assembly generated by NCC Compiler
bits 16
org 0x8000

; Function: _after_diskload
__after_diskload:
    push bp
    mov bp, sp

    ; Function call to clearScreen
    call _clearScreen
    ; Function call to writeString
    ; String literal: NCC Bootloader\r\n
    mov ax, kernel_string_0 ; Address of string
    push ax ; Argument 1
    call _writeString
    add sp, 2 ; Remove arguments
    ; Function call to writeString
    ; String literal: Loading kernel...\r\n
    mov ax, kernel_string_1 ; Address of string
    push ax ; Argument 1
    call _writeString
    add sp, 2 ; Remove arguments
    ; Local variable declaration: a
    ; String literal: Meow
    mov ax, kernel_string_2 ; Address of string
    push ax ; Initialize local variable
    ; Local variable declaration: b
    ; String literal: Woof
    mov ax, kernel_string_3 ; Address of string
    push ax ; Initialize local variable
    ; Function call to dothing
    mov ax, [bp-4] ; Load local variable b
    push ax ; Argument 2
    mov ax, [bp-2] ; Load local variable a
    push ax ; Argument 1
    call _dothing
    add sp, 4 ; Remove arguments
    ; Function call to haltForever
    call _haltForever

__after_diskload_exit:
    ; Standard function epilogue
    mov sp, bp
    pop bp
    ret

; Function: dothing
_dothing:
    push bp
    mov bp, sp

    ; Function call to writeString
    ; String literal: Doing thing...\r\n
    mov ax, kernel_string_4 ; Address of string
    push ax ; Argument 1
    call _writeString
    add sp, 2 ; Remove arguments
    ; Function call to writeString
    ; String literal: a: 
    mov ax, kernel_string_5 ; Address of string
    push ax ; Argument 1
    call _writeString
    add sp, 2 ; Remove arguments
    ; Function call to writeString
    mov ax, [bp+4] ; Load parameter a
    push ax ; Argument 1
    call _writeString
    add sp, 2 ; Remove arguments
    ; Function call to writeString
    ; String literal: \r\n
    mov ax, kernel_string_6 ; Address of string
    push ax ; Argument 1
    call _writeString
    add sp, 2 ; Remove arguments
    ; Function call to writeString
    ; String literal: b: 
    mov ax, kernel_string_7 ; Address of string
    push ax ; Argument 1
    call _writeString
    add sp, 2 ; Remove arguments
    ; Function call to writeString
    mov ax, [bp+6] ; Load parameter b
    push ax ; Argument 1
    call _writeString
    add sp, 2 ; Remove arguments
    ; Function call to writeString
    ; String literal: \r\n
    mov ax, kernel_string_8 ; Address of string
    push ax ; Argument 1
    call _writeString
    add sp, 2 ; Remove arguments

_dothing_exit:
    ; Standard function epilogue
    mov sp, bp
    pop bp
    ret

; Function: assert
_assert:
    push bp
    mov bp, sp

    ; If statement
    mov ax, [bp+4] ; Load parameter condition
    test ax, ax ; Test if AX is zero
    setz al ; Set AL to 1 if AX is zero, 0 otherwise
    movzx ax, al ; Zero-extend AL to AX
    test ax, ax
    jz if_end1
    ; If true branch
    ; Function call to writeString
    ; String literal: Assertion failed!\r\n
    mov ax, kernel_string_9 ; Address of string
    push ax ; Argument 1
    call _writeString
    add sp, 2 ; Remove arguments
    ; Function call to haltForever
    call _haltForever
if_end1:

_assert_exit:
    ; Standard function epilogue
    mov sp, bp
    pop bp
    ret

; Function: clearScreen
_clearScreen:
    push bp
    mov bp, sp

    ; Inline assembly statement
    mov ax, 0x0003
    ; Inline assembly statement
    int 0x10

_clearScreen_exit:
    ; Standard function epilogue
    mov sp, bp
    pop bp
    ret

; Function: haltForever
_haltForever:
    ; Naked function - no prologue generated
    ; Inline assembly statement
    cli
    ; Inline assembly statement
    hlt
    ; Inline assembly statement
    jmp _haltForever

_haltForever_exit:
    ; Naked function - no epilogue generated

; Function: writeChar
_writeChar:
    push bp
    mov bp, sp

    ; Inline assembly statement
    mov al, [bp+4]
    ; Inline assembly statement
    mov ah, 0x0E
    ; Inline assembly statement
    mov bx, 0x0007
    ; Inline assembly statement
    int 0x10

_writeChar_exit:
    ; Standard function epilogue
    mov sp, bp
    pop bp
    ret

; Function: writeString
_writeString:
    push bp
    mov bp, sp

    ; While loop
while_cond2:
    mov ax, [bp+4] ; Load parameter str
    ; Dereferencing pointer
    mov bx, ax ; Move pointer address to BX
    cmp bx, 0 ; Check for null pointer
    je null_ptr_deref_5
    xor ah, ah ; Clear high byte for char
    mov al, [bx] ; Load byte (char) from memory
    jmp ptr_deref_end_5
null_ptr_deref_5:
    ; Null pointer dereference detected
    mov ax, 0 ; Return 0 for null deref
ptr_deref_end_5:
    test ax, ax
    jz while_end4
while_body3:
    ; Loop body
    ; Function call to writeChar
    ; Postfix increment of parameter str
    mov ax, [bp+4] ; Load parameter value
    mov bx, ax ; Save original value to BX
    inc bx ; Increment value
    mov [bp+4], bx ; Store incremented value back
    ; Dereferencing pointer
    mov bx, ax ; Move address to BX
    cmp bx, 0 ; Check for null pointer
    je null_ptr_deref_6
    mov ax, [bx] ; Load word from memory
    jmp ptr_deref_end_6
null_ptr_deref_6:
    ; Null pointer dereference detected
    mov ax, 0 ; Return 0 for null deref
ptr_deref_end_6:
    push ax ; Argument 1
    call _writeChar
    add sp, 2 ; Remove arguments
    jmp while_cond2
while_end4:

_writeString_exit:
    ; Standard function epilogue
    mov sp, bp
    pop bp
    ret

; Function: enterVBEGraphicsMode
_enterVBEGraphicsMode:
    push bp
    mov bp, sp

    ; Inline assembly statement
    mov ax, 0x4F02
    ; Inline assembly statement
    mov bx, 0x118
    ; Inline assembly statement
    int 0x10

_enterVBEGraphicsMode_exit:
    ; Standard function epilogue
    mov sp, bp
    pop bp
    ret


; Data section for strings and arrays
; String literals section
kernel_string_0: db 78, 67, 67, 32, 66, 111, 111, 116, 108, 111, 97, 100, 101, 114, 13, 10, 0  ; null terminator
kernel_string_1: db 76, 111, 97, 100, 105, 110, 103, 32, 107, 101, 114, 110, 101, 108, 46, 46, 46, 13, 10, 0  ; null terminator
kernel_string_2: db 77, 101, 111, 119, 0  ; null terminator
kernel_string_3: db 87, 111, 111, 102, 0  ; null terminator
kernel_string_4: db 68, 111, 105, 110, 103, 32, 116, 104, 105, 110, 103, 46, 46, 46, 13, 10, 0  ; null terminator
kernel_string_5: db 97, 58, 32, 0  ; null terminator
kernel_string_6: db 13, 10, 0  ; null terminator
kernel_string_7: db 98, 58, 32, 0  ; null terminator
kernel_string_8: db 13, 10, 0  ; null terminator
kernel_string_9: db 65, 115, 115, 101, 114, 116, 105, 111, 110, 32, 102, 97, 105, 108, 101, 100, 33, 13, 10, 0  ; null terminator
